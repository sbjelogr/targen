<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Demo - targen</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/ansi-colours.css" rel="stylesheet" />
  <link href="../css/jupyter-cells.css" rel="stylesheet" />
  <link href="../css/pandas-dataframe.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Demo";
    var mkdocs_page_input_path = "1_Demo_Target.ipynb";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> targen</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Demo</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#get-random-data">Get random data</a>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">targen</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Demo</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/sbjelogr/targen/edit/master/docs/1_Demo_Target.ipynb"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="demo">Demo</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">%load_ext autoreload
%autoreload 2
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from sklearn.datasets import make_classification

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

from targen.data import target
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="get-random-data">Get random data</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">X, dummy = make_classification( n_samples=1000,
    n_features=20)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Map it to the dataframe</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">data = pd.DataFrame(X, columns = [f'col_{ix}' for ix in range(X.shape[1])])
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">data
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col_0</th>
      <th>col_1</th>
      <th>col_2</th>
      <th>col_3</th>
      <th>col_4</th>
      <th>col_5</th>
      <th>col_6</th>
      <th>col_7</th>
      <th>col_8</th>
      <th>col_9</th>
      <th>col_10</th>
      <th>col_11</th>
      <th>col_12</th>
      <th>col_13</th>
      <th>col_14</th>
      <th>col_15</th>
      <th>col_16</th>
      <th>col_17</th>
      <th>col_18</th>
      <th>col_19</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0</th>
      <td>-1.850339</td>
      <td>-1.197340</td>
      <td>-0.355523</td>
      <td>1.116181</td>
      <td>1.845710</td>
      <td>-0.477279</td>
      <td>1.487521</td>
      <td>0.315630</td>
      <td>0.133985</td>
      <td>-1.023797</td>
      <td>-1.047755</td>
      <td>0.650470</td>
      <td>-0.318144</td>
      <td>1.666031</td>
      <td>0.175629</td>
      <td>-1.099117</td>
      <td>-0.756235</td>
      <td>-0.506405</td>
      <td>0.427088</td>
      <td>-0.513930</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.488588</td>
      <td>-0.913817</td>
      <td>-1.418795</td>
      <td>-0.747513</td>
      <td>0.355358</td>
      <td>-0.139962</td>
      <td>-0.687829</td>
      <td>-0.149273</td>
      <td>0.551018</td>
      <td>-1.487871</td>
      <td>0.565381</td>
      <td>-0.684635</td>
      <td>0.463179</td>
      <td>-1.374709</td>
      <td>1.619136</td>
      <td>-0.674355</td>
      <td>-1.599199</td>
      <td>0.909847</td>
      <td>1.402835</td>
      <td>-0.347821</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.588405</td>
      <td>-0.071284</td>
      <td>-0.369446</td>
      <td>0.751150</td>
      <td>-1.082550</td>
      <td>-0.731904</td>
      <td>-0.194864</td>
      <td>1.372475</td>
      <td>-1.539740</td>
      <td>0.300565</td>
      <td>2.208001</td>
      <td>-1.853615</td>
      <td>0.578585</td>
      <td>0.156055</td>
      <td>-0.892241</td>
      <td>-1.392123</td>
      <td>-0.040691</td>
      <td>0.309030</td>
      <td>0.285427</td>
      <td>1.147056</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.701368</td>
      <td>0.570917</td>
      <td>-1.248805</td>
      <td>-0.170574</td>
      <td>-0.750793</td>
      <td>0.629564</td>
      <td>-2.122336</td>
      <td>0.731701</td>
      <td>-1.188198</td>
      <td>0.706921</td>
      <td>1.544067</td>
      <td>-0.638208</td>
      <td>-0.665960</td>
      <td>0.821595</td>
      <td>-0.600191</td>
      <td>-1.040545</td>
      <td>-0.306324</td>
      <td>-1.203122</td>
      <td>1.000677</td>
      <td>0.704866</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.184303</td>
      <td>1.012137</td>
      <td>-1.679044</td>
      <td>1.489328</td>
      <td>-0.932593</td>
      <td>0.857415</td>
      <td>0.996254</td>
      <td>0.730320</td>
      <td>-0.476816</td>
      <td>-1.924601</td>
      <td>-0.056678</td>
      <td>0.340880</td>
      <td>0.488011</td>
      <td>-1.848826</td>
      <td>-1.419831</td>
      <td>1.471304</td>
      <td>-1.982000</td>
      <td>0.447148</td>
      <td>1.679173</td>
      <td>-1.702966</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>-0.091892</td>
      <td>-0.934044</td>
      <td>0.147880</td>
      <td>0.163007</td>
      <td>-0.342986</td>
      <td>0.627779</td>
      <td>0.656880</td>
      <td>-0.460088</td>
      <td>0.406351</td>
      <td>0.130552</td>
      <td>-0.382486</td>
      <td>0.691892</td>
      <td>-0.353274</td>
      <td>1.675991</td>
      <td>-0.021521</td>
      <td>0.697908</td>
      <td>0.153288</td>
      <td>0.252674</td>
      <td>-0.143369</td>
      <td>0.401495</td>
    </tr>
    <tr>
      <th>996</th>
      <td>-0.527461</td>
      <td>0.150344</td>
      <td>2.356521</td>
      <td>-0.490172</td>
      <td>0.008494</td>
      <td>-0.276413</td>
      <td>-0.612870</td>
      <td>0.604112</td>
      <td>0.552222</td>
      <td>0.388602</td>
      <td>-0.564388</td>
      <td>-0.244958</td>
      <td>-2.421771</td>
      <td>0.261117</td>
      <td>-0.513333</td>
      <td>0.486842</td>
      <td>1.518778</td>
      <td>1.545145</td>
      <td>-2.088257</td>
      <td>-0.714567</td>
    </tr>
    <tr>
      <th>997</th>
      <td>1.365803</td>
      <td>-1.024724</td>
      <td>-0.898050</td>
      <td>1.260115</td>
      <td>-0.137339</td>
      <td>-0.162091</td>
      <td>0.728386</td>
      <td>0.385492</td>
      <td>1.142555</td>
      <td>0.351636</td>
      <td>0.138634</td>
      <td>-0.906503</td>
      <td>1.225850</td>
      <td>0.016768</td>
      <td>-0.606482</td>
      <td>2.070227</td>
      <td>-0.305880</td>
      <td>0.913492</td>
      <td>0.737808</td>
      <td>0.051384</td>
    </tr>
    <tr>
      <th>998</th>
      <td>0.176144</td>
      <td>-0.329279</td>
      <td>1.793467</td>
      <td>-1.074545</td>
      <td>0.072454</td>
      <td>0.907962</td>
      <td>-0.346622</td>
      <td>-1.672273</td>
      <td>0.391016</td>
      <td>0.568188</td>
      <td>1.140742</td>
      <td>0.298060</td>
      <td>0.143206</td>
      <td>1.991956</td>
      <td>1.320334</td>
      <td>-0.173261</td>
      <td>1.304673</td>
      <td>1.713957</td>
      <td>-1.620925</td>
      <td>-1.133157</td>
    </tr>
    <tr>
      <th>999</th>
      <td>-0.479005</td>
      <td>-0.558306</td>
      <td>-1.227481</td>
      <td>-1.339434</td>
      <td>0.800535</td>
      <td>0.956403</td>
      <td>0.845787</td>
      <td>-3.654895</td>
      <td>0.553783</td>
      <td>0.647686</td>
      <td>-0.815307</td>
      <td>0.204758</td>
      <td>-1.444925</td>
      <td>1.636026</td>
      <td>0.765934</td>
      <td>0.941225</td>
      <td>-0.326851</td>
      <td>-1.838087</td>
      <td>0.989065</td>
      <td>-0.899723</td>
    </tr>
  </tbody>
</table>
<p>1000 rows Ã— 20 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="define-all-expressions-in-one-go-and-get-the-targets">Define all expressions in one go and get the targets</h1>
<p>Quick way to get your y target.<br></p>
<p>Define the expression dictionary as in the example below.</p>
<p>Allowed keys are</p>
<ul>
<li>linear: expects a value being a string with an expression</li>
<li>non_linear: expects a value being a string with an expression</li>
<li>interaction: expects a value being a string with an expression</li>
<li>
<p>conditional: expects a dictionary, where:<br></p>
<ul>
<li>keys: are the conditions</li>
<li>values are tuples:<ul>
<li>the first element is the expression or a value to assign to in case when the conditions is true</li>
<li>the second element is the expression or a value to assign to in case when the conditions is false</li>
</ul>
</li>
</ul>
</li>
<li>
<p>uniform noise: expects a dictionary with kwargs to apply, options are</p>
<ul>
<li>weight</li>
<li>min (for scaling)</li>
<li>max (for scaling)</li>
</ul>
</li>
<li>
<p>gaussian noise: expects a dictionary with kwargs to apply, options are</p>
<ul>
<li>weight</li>
<li>mu_gaus</li>
<li>sigma_gaus</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">expressions = {
    'linear': '-0.5*col_0 + 2.*col_1 + 0.7*col_7 -0.4*col_14',
    'non_linear': '-0.7*col_1**1.5 + 0.2*sin(col_7)+ 0.9*log(col_19) -0.1*col_13**2',
    'interaction': '0.05*col_3*col_4 -0.1*(col_7/col_11)',
    'conditional': {
        'col_0&gt;0':(
            '-0.5*col_0 + 2.*col_1 + 0.7*col_7 -0.4*col_14', #True
            0 #False
        ),
        'col_2&gt;0.15':(
            '-0.5*col_0 + 2.*col_13 + 0.2*col_17 -0.7*col_11',#True
            '-0.5*col_1' #False
        )
    },
    'uniform_noise': {
        'weight':0.5
    },
    'gaussian_noise': {
        'weight':0.5,
        'mu_gaus': 0
    }
}
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">contr_and_target_df = target.get_target_and_contributions(data, expressions=expressions, imbalance = 0.2)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">contr_and_target_df.head()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score_linear</th>
      <th>score_non_linear</th>
      <th>score_interaction</th>
      <th>score_conditional</th>
      <th>score_uniform_noise</th>
      <th>score_gaussian_noise</th>
      <th>score_total</th>
      <th>y</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0</th>
      <td>0.818894</td>
      <td>-0.975218</td>
      <td>-0.062286</td>
      <td>0.000000</td>
      <td>-0.032489</td>
      <td>0.036209</td>
      <td>-0.214890</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.499113</td>
      <td>-0.908762</td>
      <td>-0.105083</td>
      <td>0.499113</td>
      <td>-0.457964</td>
      <td>-0.267424</td>
      <td>-0.741006</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.231402</td>
      <td>-0.575233</td>
      <td>-0.273727</td>
      <td>0.000000</td>
      <td>-0.135429</td>
      <td>0.454203</td>
      <td>0.701217</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.433956</td>
      <td>-0.779449</td>
      <td>-0.133892</td>
      <td>0.000000</td>
      <td>-0.219048</td>
      <td>0.287103</td>
      <td>0.588670</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.461646</td>
      <td>-1.757218</td>
      <td>-0.093105</td>
      <td>1.461646</td>
      <td>-0.348126</td>
      <td>-0.434450</td>
      <td>0.290392</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">contr_and_target_df['y'].value_counts()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>0    800
1    200
Name: y, dtype: int64</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="build-your-own-contributions">Build your own contributions</h1>
<p>This part descrives the inner workings of the <code>get_target_and_contributions</code> function.</p>
<h3 id="simple-contributions">Simple contributions</h3>
<p>Define here the contributions to use.<br></p>
<p>Note the function <code>score_from_expressions</code>, this one can use any type of input.<br></p>
<p>For documentation purposes, it is split in linear, non linear and interaction component, but they can be defined in one expression as well.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">linear_component = '-0.5*col_0 + 2.*col_1 + 0.7*col_7 -0.4*col_14'
non_linear_component = '-0.7*col_1**1.5 + 0.2*sin(col_7)+ 0.9*log(col_19) -0.1*col_13**2'
inter_component = '0.05*col_3*col_4 -0.1*(col_7/col_11)'
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">score_linear = target.score_from_expression(data, expr=linear_component)
score_non_linear = target.score_from_expression(data, expr=non_linear_component)
score_interaction = target.score_from_expression(data, expr=inter_component)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="conditional-interaction">Conditional interaction</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">cond_expr = {
    'col_0&gt;0':(
        '-0.5*col_0 + 2.*col_1 + 0.7*col_7 -0.4*col_14', #True
        0 #False
    ),
    'col_2&gt;0.15':(
        '-0.5*col_0 + 2.*col_13 + 0.2*col_17 -0.7*col_11',#True
        '-0.5*col_1' #False
    )
}
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">cond_scores = target.score_with_condition(data,cond_expr = cond_expr )
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">cond_scores
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>0      0.000000
1      0.499113
2      0.000000
3      0.000000
4      1.461646
         ...   
995    0.000000
996    0.000000
997    0.661167
998    0.642566
999    0.000000
Length: 1000, dtype: float64</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="noise-contribution">Noise contribution</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">score_random_noise = target.score_uniform_noise(data, weight=0)
score_gaussian_noise = target.score_gaussian_noise(data, weight=0, mu_gaus=0.5)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="put-it-all-together-and-get-the-target">Put it all together and get the target</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">score_final = score_linear + score_non_linear + score_interaction + cond_scores + score_random_noise + score_gaussian_noise
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">y = target.define_target(score_final, imbalance_fraction=0.5)

y.value_counts()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>1    500
0    500
dtype: int64</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="check-the-performances">Check the performances</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from sklearn.metrics import roc_auc_score
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">roc_auc_score(y, score_final)
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>1.0</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">print(f'Linear AUC     : {np.round(roc_auc_score(y, score_linear),4)}')
print(f'Non Linear AUC : {np.round(roc_auc_score(y, score_non_linear),4)}')
print(f'Interaction AUC: {np.round(roc_auc_score(y, score_interaction),4)}')
print(f'Conditional AUC: {np.round(roc_auc_score(y, cond_scores),4)}')
print(f'Max AUC        : {np.round(roc_auc_score(y, score_linear + score_non_linear + score_interaction + cond_scores ),4)}')
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>Linear AUC     : 0.7025
Non Linear AUC : 0.6378
Interaction AUC: 0.4382
Conditional AUC: 0.8257
Max AUC        : 1.0
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="simple-try">Simple try</h1>
<p>Add only linear contribution, build a Logisict Regression and see the interpretation</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">y_lin = target.define_target(score_linear, imbalance_fraction=0.5)
y_lin.value_counts()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>1    500
0    500
dtype: int64</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import MinMaxScaler
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">linear_component
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&#39;-0.5*col_0 + 2.*col_1 + 0.7*col_7 -0.4*col_14&#39;</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">X_lin = MinMaxScaler().fit_transform(data[['col_0', 'col_1', 'col_7','col_14']])
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">lr = LogisticRegression(penalty='none', fit_intercept=False).fit(X_lin,y_lin)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">roc_auc_score(y_lin,lr.predict_proba(X_lin)[:,1])
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>0.9398759999999998</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">lr.coef_, lr.intercept_
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>(array([[ -9.9421794 ,  17.88254454,   1.36980712, -11.23104604]]),
 array([0.]))</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from scipy.stats import logistic
from scipy.special import expit
</code></pre>


</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">logistic.cdf(score_linear)[y_lin==1].min()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>0.7332163442004278</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">logistic.cdf(score_linear)[y_lin==0].max()
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>0.7330079939503215</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">
</code></pre>


</div>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/sbjelogr/targen/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
